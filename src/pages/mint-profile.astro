// React and dependency imports
import { useEffect } from 'react';
import { ethers } from 'ethers';
import { useStore } from '@nanostores/react';
import { userStore } from '../stores/userStore';

const currentUser = useStore(userStore);

useEffect(() => {
  if (!currentUser) {
    window.location.href = '/api/discord/login';
  }
}, [currentUser]);

// HTML portion
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mint Profile - NGU Meme dApp</title>
  </head>
  <body>
    <h1>Mint Your Profile Soul Bound Token</h1>
    <p>Welcome, {currentUser?.username}!</p>
    <p>Your role: {currentUser?.role}</p>
    <button id="mintButton">Mint SBT</button>
    <script type="module">
      import { ethers } from 'ethers';

      const mintButton = document.getElementById('mintButton');
      mintButton.addEventListener('click', async () => {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send('eth_requestAccounts', []);
        const signer = provider.getSigner();
        const sbtContract = new ethers.Contract(
          import.meta.env.SBT_ADDRESS,
          ['function mint(address to)'],
          signer
        );
        const tx = await sbtContract.mint(await signer.getAddress());
        await tx.wait();
        alert('SBT Minted Successfully!');
      });
    </script>
  </body>
</html>
